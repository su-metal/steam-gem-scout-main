# 気分スライダー仕様：旧 → 新 統合差分ガイド
本ドキュメントは、既存の **「気分スライダー_aiバッジ_フィルタリング設計.md」**（旧仕様）と、
新たに確定した **「気分スライダー設計メモ v1」**（新仕様）を比較し、
**プロジェクト全体のどこをどう修正すればよいか** を 1 枚で把握できるよう整理したものです。

---

# 1. 仕様の大きな変更点（サマリー）

## ✔ 旧仕様
- スライダー軸は概念的で、3 ～ 4 軸が曖昧に混在。
- UI の文言に「ライト」「重厚」「サクっと」「ヘビー」など **軸が重複する語彙** が存在。
- Advanced なし（全軸が同列）
- 内部ベクトルは少数軸で、AI 解析に強く依存。

## ✔ 新仕様（今回確定）
- **メイン 3 軸 ＋ Advanced 2 軸 の “5 軸構造” に再定義**。
- 軸の役割を完全分離し、混乱しない短い日本語ラベルに刷新。
- デスクトップは **左右 2 カラムレイアウト** へ刷新。右側に Advanced 小カード。
- 内部ロジックは **5 次元 MoodVector** に統一（operation / session / tension / story / brain）。
- AI は「補正」レイヤーに格下げ → ベースはタグ変換で計算。

---

# 2. スライダー軸：旧 → 新 の対応表

| 旧仕様の軸 | 新仕様の軸 | 新UI表示（短い文言） | 内部キー | 備考 |
|-----------|-------------|------------------------|-----------|------|
| Passive ↔ Active（曖昧） | **操作量軸** | ゆったり ←→ アクション多め | `operation` | 文言を統一・明確化 |
| Short ↔ Long（OK） | **セッション長軸** | 短め ←→ 長め | `session` | そのまま利用 |
| Cozy ↔ High-Challenge（混同） | **テンション軸** | 癒やし ←→ 緊張感 | `tension` | "High-Challenge" を緊張/スリルへ変更 |
| （旧：曖昧） | **ストーリー濃度軸（ADV）** | プレイ重視 ←→ ナラティブ | `story` | Advanced Filters へ分離 |
| （旧：曖昧） | **思考負荷軸（ADV）** | シンプル ←→ じっくり | `brain` | Advanced Filters へ分離 |

---

# 3. UI 実装修正ポイント

## 3.1 Index.tsx（メイン UI）
### 修正内容
- **VIBE_SLIDERS の定義を BASE（3本）＋ ADVANCED（2本）に分離**
- 新しいラベル文言へ差し替え
- `vibe-layout` を用いた **左右 2 カラム構成** に変更
- `.vibe-advanced-panel` を追加し、Advanced カードを右側に表示
- Advanced 開閉の state（`showAdvancedVibes`）を導入

### 影響箇所（Index.tsx 内）
- スライダー定義ブロック
- Vibe UI セクション全体の JSX
- Advanced Filters の map レンダリング

## 3.2 landing.css（スタイル）
### 修正内容
- `.vibe-card` の max-width: 980px に調整
- `.vibe-layout` の新設 → 左右 2 カラム（1.6 : 1.1）
- `.vibe-main` / `.vibe-advanced-panel` の追加
- `.vibe-advanced` / `.vibe-row` など旧レイアウト用クラスを削除
- モバイル時（<800px）は 1 カラムへ落とす

### 追加が必要な新規クラス
- `.vibe-layout`
- `.vibe-main`
- `.vibe-advanced-panel`
- `.vibe-advanced-header`
- `.vibe-advanced-sliders`
- `.vibe-advanced-toggle`

---

# 4. データ構造（DB / API）変更点

## 4.1 ゲーム気分ベクトル：旧 → 新
### 旧
- 3～4軸の曖昧な構造、名称も不統一。

### 新
```ts
interface MoodVector {
  operation: number; // Passive ↔ Active
  session: number;   // Short ↔ Long
  tension: number;   // Cozy ↔ Intense
  story: number;     // Play-focused ↔ Narrative
  brain: number;     // Simple ↔ Deep
}
```
→ **DB の mood_scores をこの5軸に合わせて再構成**

## 4.2 search-games / get-similar-gems API
### 修正ポイント
- 受け取るユーザー気分値を **5 軸に統一**
- matchScore 計算を 5 次元で行う
- 旧キー（active / volume / stress など）は廃止

## 4.3 analyze-hidden-gem
- AI 側で抽出した「Cozy」「Intense」「Story」「Strategy」などのワードを、5軸の補正に回す
- 補正関数：`applyAiMoodAdjustment()` を新仕様に合わせて更新

---

# 5. タグ → スコア変換ロジック（TAG_TO_MOOD）
旧仕様は 2～3軸の曖昧な重みだったが、新仕様では以下の 5 軸へ分配する。

#### 例：
```ts
"Action":       { operation: 0.9 },
"Roguelite":    { session: 0.3, operation: 0.5, brain: 0.3 },
"Horror":       { tension: 1.0 },
"Story Rich":   { story: 1.0 },
"Strategy":     { brain: 1.0 },
```

### 修正ポイント
- operation / session / tension / story / brain の 5 軸に合わせて、タグを再マッピング
- 旧タグマッピングの削除（active/stress等）
- normalize(-3～+3 → 0～1) ロジックはそのまま再利用可

---

# 6. マッチングアルゴリズム修正
旧：3軸の距離ベース
新：**5軸の距離ベース（重みは全軸 = 1 でよい）**

```ts
function calcMoodMatchScore(game: MoodVector, user: UserMoodPrefs): number {
  let score = 0;
  const KEYS: MoodSliderId[] = ["operation","session","tension","story","brain"];

  for (const k of KEYS) {
    const diff = Math.abs(game[k] - user[k]);
    score += (1 - diff);
  }

  return score / KEYS.length; // 0〜1
}
```

→ **検索結果やランキングは matchScore を降順にして利用**

---

# 7. AI 解析ロジックの更新
- AI の役割は **タグベースの mood_scores を補正するだけ** に簡素化
- pros/cons から抽出される価値は GameDetail に限定
- Hidden Gem ラベル解析はそのまま（気分スライダーとは分離）

### 修正例
```ts
if (analysis.labels.includes("Cozy")) out.tension -= 0.2;
if (analysis.labels.includes("High Challenge")) out.tension += 0.2;
if (analysis.labels.includes("Story")) out.story += 0.2;
if (analysis.labels.includes("Strategy")) out.brain += 0.2;
```

---

# 8. UI 文言の刷新点（全部差し替える）
旧 UI にあった：
- ライト
- 重厚
- サクっと
- ヘビー
- まったり

これらはすべて **新しい短い対義語ペア** に置き換える。

### 新 UI 文言
| 軸 | 左 | 右 |
|---|---|---|
| 操作量 | ゆったり | アクション多め |
| セッション長 | 短め | 長め |
| テンション | 癒やし | 緊張感 |
| ストーリー濃度（ADV） | プレイ重視 | ナラティブ |
| 思考負荷（ADV） | シンプル | じっくり |


---

# 9. すべての修正に関連するファイル一覧

| 種別 | 修正が必要なファイル | 内容 |
|------|---------------------|-------|
| UI | `Index.tsx` | スライダー定義変更 / レイアウト再構築 / ラベル文言更新 |
| UI | `landing.css` | 新レイアウト追加 / 旧レイアウト削除 |
| API | `search-games` | matchScore 5軸対応 / userVibes 仕様更新 |
| API | `get-similar-gems` | mood_scores仕様変更に追従 |
| Parsing | `import-steam-games` | mood_scores 計算ロジックを 5軸へ更新 |
| Parsing | `analyze-hidden-gem` | AI補正ロジックを新5軸へ変更 |
| DB | `steam_games` or `game_rankings_cache` | mood_scores カラムを5軸仕様で再格納 |

---

# 10. 最終まとめ（実装の優先度順）
1. **UI の軸・文言・レイアウトの刷新**（Index.tsx / landing.css）
2. **mood_scores のデータ構造を 5 軸に統合**（DB / import-steam-games）
3. **TAG_TO_MOOD マッピングを 5 軸に書き換え**
4. **matchScore を 5 軸距離アルゴリズムに変更**
5. **analysis の補正ロジックを新仕様に更新**
6. search-games / get-similar-gems を mood_scores = 5 軸へ対応

---

このガイドを参照すれば、旧仕様から新仕様へ必要な修正点がすべて把握でき、
どのファイルをどのように手直しすればよいかが明確になります。

